# Глава 1. Установка и первоначальная настройка PostgreSQL в Linux



Чтобы установить СУБД PostgreSQL в Linux, нужно выполнить одно из следующих действий:

1. Ввести в "Центре приложений" postgresql и выбрать одно из приложений (в убунту-22.04 на выбор предлагаются версии 9.5 и 10, хотя в 2024 году, когда я пишу эти строки, уже вышла 17 версия)
2. Установить postgresql вручную, введя в терминале следующие команды.

До загрузки PostgreSQL обновляем списки пакетов:

```
$ sudo apt update
```

Загрузим PostgreSQL с утилитой postgresql-contrib:

```
$ sudo apt install postgresql postgresql-contrib
```

Загрузятся драйверы PostgreSQL последней версии (обратите внимание: не самой последней версии, доступной у разработчика СУБД, а последней версии, поддерживаемой Вашей версией операционной системы Linux и хранящейся в её репозиторях!) и развернутся необходимые компоненты на виртуальной машине с Ubuntu. Чтобы СУБД начала работать, необходимо запустить её как сервис:

```
$ sudo systemctl start postgresql.service
```

Проверим статус сервиса:

```
$ sudo systemctl status postgresql.service
```

В ответ на эту команду система запросит пароль суперпользователя, а получив его - выведет сообщение:

```
● postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/lib/systemd/system/postgresql.service; enabled; vendor pr>
     Active: active (exited) since Wed 2024-11-06 08:12:35 MSK; 11h ago
   Main PID: 2047 (code=exited, status=0/SUCCESS)
        CPU: 1ms

ноя 06 08:12:35 m40-A320M-H systemd[1]: Starting PostgreSQL RDBMS...
ноя 06 08:12:35 m40-A320M-H systemd[1]: Finished PostgreSQL RDBMS.

```

Чтобы вернуться в терминал, нажмём Ctrl+Z, это переведёт команду в фоновый режим, но не остановит её выполнение.

Сервис развернули, теперь разберемся в работе аккаунтов. PostgreSQL для обозначения аккаунта применяет термин «Роль». В Unix-системе роли сервиса привязываются к одноименным аккаунтам. При установке PostgreSQL в системе создаётся аккаунт postgres, получающий в СУБД максимальные права (в СУБД, но не в операционной системе!). Этот аккаунт нужен для того, чтобы создавать пользователей и новые базы данных и связывать их. Самый важный принцип работы в PostgreSQL прост: один пользователь - одна база данных.

Как показала практика работы со студентами, установка и предварительная настройка СУБД представляет для них определённую проблему. Связано это, по-видимому, с необходимостью вводить разные команды компьютеру от имени разных пользователей (и в разных средах - что-то вводится в строке приглашения к вводу терминала, что-то - в строке приглашения к вводу СУБД), причём если перепутать пользователя или команду, результат будет, естественно, другим (скорее всего, неожиданным).

Прежде чем мы приступим к созданию и настройке пользователя, который будет работать с базой данных, хочу обратить ваше внимание на то, что все вводимые в консоли команды будут выполняться от имени текущего пользователя — его имя вы увидите в самом начале приглашения к вводу терминала. Предположим, что вы работаете за компьютером *kab1805* от имени пользователя *kab18-05*, тогда приглашение к вводу будет выглядеть следующим образом:

```
kab18-05@kab1805:~$
```

Имя пользователя отделено от имени хоста знаком @, после имени хоста стоит двоеточие, за которым следует указание места положения (папки), в которой сейчас находится пользователь (команда, выполненная пользователем, будет взаимодействовать с файлами, находящимися в этой папке). Знак тильда (~) обозначает домашнюю папку текущего пользователя (то есть /home/kab18-05). После тильды следует знак доллара, который обозначает, что все вводимые команды будут выполнены от имени обычного пользователя (знак # будет обозначать, что все команды будут выполнены от имени суперпользователя).

Обращайте внимание на то, от чьего имени запускается та или иная команда — это имеет решающее значение!

Итак, прежде всего переключимся на пользователя postgres (созданного при установке СУБД):

```
kab18-05@kab1805:~# sudo -i -u postgres
```

После этого запустим PostgreSQL и создадим пользователя, попутно задав ему пароль «1234» (обращаем внимание на одинарные кавычки!). Ещё один важный момент: я создаю пользователя test, вам нужно создавать собственного пользователя, и если вы используете эту инструкцию на занятиях, в аудитории, пароль должен быть достаточно сильным, чтобы одногруппники не "сломали" вашу базу данных (поверьте, некоторые из них просто обожают это делать!). Итак, действуем:

```
postgres@kab1805:~psql
```

```
postgres=#CREATE USER test WITH PASSWORD '1234'
```

Выходим из СУБД:

```
postgres-#\q
```

Не выходя из учётной записи администратора PostgreSQL (postgres), создадим базу данных (название базы данных, в нашем примере — test — должно совпадать с именем пользователя, созданного в предыдущем шаге, иначе вы не сможете назначить права на эту базу данных своему пользователю):

```
postgres@kab1805:~createdb test
```

Снова входим в СУБД и даём пользователю test все права на базу данных test:

```
postgres@kab1805:~psql
postgres=#GRANT ALL PRIVILEGES ON DATABASE test TO test;
postgres=#\q
```

Выходим из учётной записи администратора СУБД:

```
[postgres@kab1805]:~exit
```

Входим под учётной записью пользователя test в базу данных test:

```
kab18-05@kab1805:~$psql -U test -h 127.0.0.1 -p 5432
```

В следующий раз, когда нам будет нужно войти в свою базу данных, используем эту строчку, подставив в неё имя своего пользователя, соответствующая база данных будет выбрана автоматически.

Ещё один малозаметный, но немаловажный момент. Команда SQL может занимать несколько строк, при этом её перенос не требует ввода каких-либо спецсимволов. Более того - нажатие клавиши `<Enter>` не закончит ввод команды и не передаст управление какой бы то ни было программе. Чтобы сказать системе, что мы ввели всю команду, нужно ввести ";" (точка с запятой) и нажать `<Enter>`. Пока точка с запятой не нажата, приглашение к вводу будет незначительно отличаться (вместо знака "равно" будет "минус"):

```
postgres-#
```

Если увидите перед знаком "#" знак "-", введя команду полностью, нажмите точку с запятой и `<Enter>`, и команда будет отправлена на выполнение. Кстати, команду с ошибками, которая была введена ранее, можно отредактировать, не набирая заново - достаточно стрелками вверх-вниз на клавиатуре пролистать до нужной строки и нажать `<Enter>`. Если команда вводилась в нескольких строках, эту операцию следует повторить (но любой фрагмент также можно и отредактировать при необходимости).


Узнать статус подключения:

```
postgres=# \conninfo
```

Увидим:

```
You are connected to database " tester " as user " tester " via socket 
in "/var/run/postgresql" at port "5432".
```

Почему я так много внимания уделяю мелочам вроде входа в систему и создания пользователя - вопросам, которые редко когда расписываются в книгах более чем на полстраницы? Мне приходилось не раз сталкиваться на практике с тем, что самой большой проблемой при изучении программирования является не само программирование, а установка и настройка всех приложений, которые вам для этого могут понадобиться. Многие ученики нуждаются в чётких однозначных инструкциях с пояснениями, что и почему они делают, повторимых на все сто процентов, иначе с большими проблемами можно столкнуться задолго до того, как ты начнёшь изучать собственно программирование, а это сильно мешает, особенно на первых порах.
